<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: angular.popup.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: angular.popup.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * @author Artem Demo
 * @git https://github.com/artemdemo/angular-popup
 */
(function(){

    var module = angular.module( 'artemdemo.popup', []);

    /**
     * Popup module for angular applications
     *
     * This module has some cool UX functionality:
     * - it will set focus on OK in simple alert popup
     * - it will focus on input if you have one in the popup (will work in confirmation popup only)
     *
     * @namespace $popup
     */
    var $popup = function( $rootScope, $compile, $q, $timeout, $sce ){
        /**
         * Popup factory object
         * @memberof $popup
         * @private
         * @type {Object}
         */
        var $popup = {};

        /**
         * Scope that will contain scope of the created popup
         * @memberof $popup
         * @private
         */
        var popupScope;

        /**
         * Popup DOM object
         * @memberof $popup
         * @private
         * @type {Object}
         */
        var popupEl;

        /**
         * I don't want to show popups one above another,
         * therefore I need to check if there is one open
         *
         * Can be 'closed' OR 'open'
         *
         * @memberof $popup
         * @private
         * @type {string}
         */
        var popupStatus = 'closed';

        /*
         * This object will contain promise.
         * It should be global because I want to use it also when user click on ESC button and in this case it should be global
         */
        var deferred = null;

        /**
         * Templates for popups
         *
         * @namespace $popup.templates
         * @memberof $popup
         * @type {Object}
         * @private
         */
        var templates = {};

        /**
         * Template for backdrop
         *
         * @memberof $popup.templates
         * @type {string}
         */
        templates.backdrop = [
            '&lt;div class="popup-backdrop">&lt;/div>'
        ].join('');

        /**
         * General template with main popup construction
         *
         * @memberof $popup.templates
         * @type {string}
         */
        templates.popup = [
            '&lt;popup>',
            '&lt;form>',
            '&lt;div class="popup-container" ng-class="POPUP_TYPE">',
            '&lt;div class="popup">',
            '&lt;div class="popup-head">',
            '&lt;h3 class="popup-title ng-binding" ng-bind-html="TITLE">&lt;/h3>',
            '&lt;/div>',
            '&lt;div class="popup-body">',
            '&lt;span ng-bind-html="BODY_TXT">&lt;/span>',
            '&lt;/div>',
            '&lt;div class="popup-buttons">&lt;/div>',
            '&lt;/div>',
            '&lt;/div>',
            '&lt;/form>',
            '&lt;/popup>'
        ].join('');

        /**
         * Template object for buttons
         *
         * @memberof $popup.templates
         * @type {Object}
         */
        templates.buttons = {};

        /**
         * Buttons for confirmation popup
         *
         * @memberof $popup.templates
         * @type {String}
         */
        templates.buttons.confirm = [
            '&lt;div class="row">',
            '&lt;div class="col-xs-6">',
            '&lt;button ng-click="okAction($event)" class="btn btn-ok" ng-class="okType || \'btn-block btn-primary\'">{{ OK_TXT }}&lt;/button>',
            '&lt;/div>',
            '&lt;div class="col-xs-6">',
            '&lt;div ng-click="cancelAction($event)" class="btn btn-cancel" ng-class="cancelType || \'btn-block btn-default\'">{{ CANCEL_TXT }}&lt;/div>',
            '&lt;/div>',
            '&lt;/div>'
        ].join('');

        /**
         * Buttons for simple alert popup
         *
         * @memberof $popup.templates
         * @type {Object}
         */
        templates.buttons.show = [
            '&lt;button ng-click="okAction($event)" class="btn btn-ok" ng-class="okType || \'btn-block btn-primary\'">{{ OK_TXT }}&lt;/button>'
        ].join('');

        /**
         * Show simple popup
         *
         * @function show
         * @memberof $popup
         * @public
         * @param {Object} params - parameters of new popup
         * @example
         *  {
                    title: 'Alert',
                    template: 'Alert body text',
                    okText: 'OK button text',
                    okType: 'OK button additional classes'
         *  }
         *
         *  @return {Promise}
         */
        $popup.show = function( params ) {
            var element;
            deferred = $q.defer();

            if ( popupStatus == 'open' ) return false;
            popupStatus = 'open';

            params = angular.isObject(params) ? params : {};

            element = compilePopup('show');

            popupScope.TITLE = params.hasOwnProperty('title') ? params.title : '';
            popupScope.BODY_TXT = params.hasOwnProperty('template') ? $sce.trustAsHtml( params.template ) : '';
            popupScope.OK_TXT = params.hasOwnProperty('okText') ? params.okText : 'Ok';
            popupScope.okType = params.hasOwnProperty('okType') ? params.okType : '';

            for ( var i=0; i &lt; element.length; i++ ) {
                document.body.appendChild( element[i] );
            }

            // Setting focus to button in order to let user to close popup in one click
            popupEl.find('button')[0].focus();

            popupScope.okAction = function() {
                deferred.resolve();
                $popup.hide();
            };

            return deferred.promise;
        };


        /**
         * Show dialog popup in the view.
         * Will create new element, new scope and link it to the DOM
         *
         * @function confirm
         * @memberof $popup
         * @public
         * @param {Object} params - parameters of new popup
         * @example
         *  {
                     title: 'Alert',
                     template: 'Alert body text',
                     cancelText: 'Cancel button text',
                     cancelType: 'Cancel button additional classes',
                     okText: 'OK button text',
                     okType: 'OK button additional classes',
                     okTap: function()
         *  }
         * @return {Promise} - Promise will return result of given onTap function
         */
        $popup.confirm = function( params ) {
            var element;
            var inputs;

            deferred = $q.defer();

            if ( popupStatus == 'open' ) return false;
            popupStatus = 'open';

            params = angular.isObject(params) ? params : {};

            element = compilePopup('confirm');

            popupScope.TITLE = params.hasOwnProperty('title') ? params.title : '';
            popupScope.BODY_TXT = params.hasOwnProperty('template') ? $sce.trustAsHtml( params.template ) : '';
            popupScope.CANCEL_TXT = params.hasOwnProperty('cancelText') ? params.cancelText : 'Cancel';
            popupScope.cancelType = params.hasOwnProperty('cancelType') ? params.cancelType : '';
            popupScope.OK_TXT = params.hasOwnProperty('okText') ? params.okText : 'Ok';
            popupScope.okType = params.hasOwnProperty('okType') ? params.okType : '';

            for ( var i=0; i &lt; element.length; i++ ) {
                document.body.appendChild( element[i] );
            }

            popupScope.cancelAction = function() {
                deferred.reject();
                $popup.hide();
            };

            $timeout(function(){
                inputs = popupEl.find('input');
                if ( inputs.length > 0 ) inputs[0].focus();
                else popupEl.find('button')[0].focus();
            });

            /**
             * Result of 'okTap' function can prevent popup from closing.
             * If result is FALSE - popup wouldn't close
             * (obviously user can close it by clicking on 'cancel' or using ESC button)
             *
             *
             * @param {Object} event - mouse event that will be send to the custom function
             *
             * @return {Promise}
             */
            popupScope.okAction = function(event) {
                var result = false;
                if ( params.hasOwnProperty('okTap') && angular.isFunction( params.okTap ) ) {
                    result = params.okTap(event);
                } else {
                    // If there are no 'okTap' function we can close popup
                    result = true;
                }
                deferred.resolve( result );
                if ( !! result ) $popup.hide();
            };

            return deferred.promise;
        };



        /**
         * Hide popup.
         * Will destroy scope of the element and remove tags from the DOM
         *
         * @function confirm
         * @memberof $popup
         * @public
         */
        $popup.hide = function() {
            popupScope.$destroy();
            popupStatus = 'closed';

            for ( var i=0; i &lt; popupEl.length; i++ ) {
                popupEl.remove();
            }

            angular.element(document.getElementsByTagName('body')[0]).unbind('keyup');
        };

        /**
         * Function is compiling element into the DOM
         *
         * @function compilePopup
         * @memberof $popup
         * @private
         * @param {String} tmpl - template name
         * @return {Object} - DOM element of popup
         */
        var compilePopup = function( tmpl ) {
            var linkFn, element;
            var backdrop, buttons;

            popupEl = angular.element( templates.popup );
            backdrop = angular.element( templates.backdrop );
            buttons = angular.element( templates.buttons[tmpl] );

            popupEl.append( backdrop );
            for ( var i=0; i&lt;buttons.length; i++ ) {
                popupEl[0].getElementsByClassName('popup-buttons')[0].appendChild(buttons[i]);
            }

            linkFn = $compile(popupEl);
            popupScope = $rootScope.$new();
            element = linkFn(popupScope);

            popupScope.POPUP_TYPE = 'popup-type-' + tmpl;

            /*
             * Bind keypress functionality
             */
            angular.element(document.getElementsByTagName('body')[0])
                // if ESC - close popup
                .bind('keyup', function(e){
                    if (e.keyCode == 27 ) {
                        deferred.reject();
                        $popup.hide();
                    }
                });

            return element;
        };

        return $popup;
    };

    module.factory('$popup',[ '$rootScope', '$compile', '$q', '$timeout', '$sce', $popup ]);

})();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Namespaces</h3><ul><li><a href="$popup.html">$popup</a></li><li><a href="$popup.templates.html">templates</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Tue Feb 03 2015 00:00:50 GMT+0200 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
